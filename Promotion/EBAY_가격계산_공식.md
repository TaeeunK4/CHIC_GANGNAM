# eBay 가격 계산 공식

> 운영 설정 기준 (pricing.yml)
> 코드: `seller-module/.../pricing/service/EbayPricingService.java`
> 설정: `api/src/main/resources/config/pricing.yml`

---

## 적용 수치

| 항목           | 변수명                       | 값                      | 출처                     |
| -------------- | ---------------------------- | ----------------------- | ------------------------ |
| 환율 (KRW→USD) | `exchange-rate`              | **1,470원**             | pricing.yml              |
| 국내배송비     | `domestic-shipping`          | **4,000원**             | pricing.yml              |
| 국제배송비     | `international-shipping-usd` | **$40** (= 58,800원)    | pricing.yml              |
| 관세 DDP       | `customs-rate`               | **15%** (매입비용 기준) | pricing.yml              |
| FedEx 수수료   | `fedex-fee-usd`              | **$8.5** (= 12,495원)   | pricing.yml              |
| eBay 수수료    | `platform-fee-rate`          | **20%** (판매가 기준)   | pricing.yml              |
| 고정 마진      | `fixed-margin`               | **10,000원**            | Java 기본값 (yml 미설정) |
| 기본 마진율    | `default-target-margin`      | **20%** (원가 기준)     | pricing.yml              |

---

## 소스별 마진율

| 소스     | 마진율  | 비고          |
| -------- | ------- | ------------- |
| kream    | 20%     |               |
| gugus    | 20%     |               |
| chicpap  | 20%     |               |
| chic     | 20%     |               |
| bunjang  | 20%     |               |
| soldout  | 20%     |               |
| naver-ss | 20%     |               |
| koibito  | **40%** | 고이비토 전용 |
| 그 외    | 20%     | 기본값        |

설정: `pricing.yml` > `automizer.source-margin-map`

---

## 계산 공식

```
① 매입비용     = 원가 + 국내배송비(4,000원)

② 국제배송비(원) = 국제배송비($40) × 환율(1,470) = 58,800원

③ 관세(원)      = 매입비용 × 관세율(15%)  ← 올림

④ FedEx수수료(원) = FedEx($8.5) × 환율(1,470) = 12,495원

⑤ 총비용        = 매입비용 + 국제배송비 + 관세 + FedEx수수료

⑥ 목표마진      = 원가 × 마진율(20%) + 고정마진(10,000원)  ← 올림

⑦ 판매가(원)    = (총비용 + 목표마진) ÷ (1 - eBay수수료율(0.20))  ← 올림
               = (총비용 + 목표마진) ÷ 0.8

⑧ 판매가(USD)   = 판매가(원) ÷ 환율(1,470)  ← 올림 (소수점 2자리)
```

(매입비용 + 58,800 + 0.15 _ 매입비용 + 12,495 + 0.4 _ (매입비용-4000) + 10,000) / 0.8 / 1,470 = 판매가

### 검증용 역산

```
eBay수수료(원) = 판매가(원) × 20%
실제마진(원)   = 판매가(원) - 총비용 - eBay수수료
실제마진율(%)  = 실제마진 ÷ 원가 × 100
```

---

## 계산 예시

### 예시 1: 원가 100,000원 (기본 마진율 20%)

| 단계 | 항목        | 계산                               | 금액          |
| ---- | ----------- | ---------------------------------- | ------------- |
| ①    | 매입비용    | 100,000 + 4,000                    | **104,000원** |
| ②    | 국제배송비  | 40 × 1,470                         | **58,800원**  |
| ③    | 관세        | 104,000 × 15%                      | **15,600원**  |
| ④    | FedEx       | 8.5 × 1,470                        | **12,495원**  |
| ⑤    | 총비용      | 104,000 + 58,800 + 15,600 + 12,495 | **190,895원** |
| ⑥    | 목표마진    | 100,000 × 20% + 10,000             | **30,000원**  |
| ⑦    | 판매가(원)  | (190,895 + 30,000) ÷ 0.8           | **276,119원** |
| ⑧    | 판매가(USD) | 276,119 ÷ 1,470                    | **$187.84**   |

검증:

- eBay수수료 = 276,119 × 20% = 55,224원
- 실제마진 = 276,119 - 190,895 - 55,224 = **30,000원**
- 실제마진율 = 30,000 ÷ 100,000 = **30.00%** (원가 대비)

### 예시 2: 원가 50,000원 (기본 마진율 20%)

| 단계 | 항목        | 계산                             | 금액          |
| ---- | ----------- | -------------------------------- | ------------- |
| ①    | 매입비용    | 50,000 + 4,000                   | **54,000원**  |
| ②    | 국제배송비  | 40 × 1,470                       | **58,800원**  |
| ③    | 관세        | 54,000 × 15%                     | **8,100원**   |
| ④    | FedEx       | 8.5 × 1,470                      | **12,495원**  |
| ⑤    | 총비용      | 54,000 + 58,800 + 8,100 + 12,495 | **133,395원** |
| ⑥    | 목표마진    | 50,000 × 20% + 10,000            | **20,000원**  |
| ⑦    | 판매가(원)  | (133,395 + 20,000) ÷ 0.8         | **191,744원** |
| ⑧    | 판매가(USD) | 191,744 ÷ 1,470                  | **130.44**    |

검증:

- eBay수수료 = 191,744 × 20% = 38,349원
- 실제마진 = 191,744 - 133,395 - 38,349 = **20,000원**
- 실제마진율 = 20,000 ÷ 50,000 = **40.00%** (원가 대비)

### 예시 3: 원가 200,000원 (koibito, 마진율 40%)

| 단계 | 항목        | 계산                               | 금액          |
| ---- | ----------- | ---------------------------------- | ------------- |
| ①    | 매입비용    | 200,000 + 4,000                    | **204,000원** |
| ②    | 국제배송비  | 40 × 1,470                         | **58,800원**  |
| ③    | 관세        | 204,000 × 15%                      | **30,600원**  |
| ④    | FedEx       | 8.5 × 1,470                        | **12,495원**  |
| ⑤    | 총비용      | 204,000 + 58,800 + 30,600 + 12,495 | **305,895원** |
| ⑥    | 목표마진    | 200,000 × 40% + 10,000             | **90,000원**  |
| ⑦    | 판매가(원)  | (305,895 + 90,000) ÷ 0.8           | **494,869원** |
| ⑧    | 판매가(USD) | 494,869 ÷ 1,470                    | **$336.65**   |

검증:

- eBay수수료 = 494,869 × 20% = 98,974원
- 실제마진 = 494,869 - 305,895 - 98,974 = **90,000원**
- 실제마진율 = 90,000 ÷ 200,000 = **45.00%** (원가 대비)

---

## 특징

1. **마진 기준은 "원가"** - 총비용이 아닌 순수 원가(매입가)에 마진율을 곱함
2. **eBay 수수료 역산** - `÷ (1 - 0.20)`으로 수수료를 포함해도 목표마진이 보장됨
3. **환율은 고정값** - 실시간 환율 API 연동 없음, `pricing.yml`에서 수동 관리
4. **모든 단계 올림(CEILING)** - 관세, 마진, 판매가 등 모든 중간 계산에서 올림 처리
5. **소스별 차등 마진** - `automizer.source-margin-map`으로 소스별 마진율 설정 가능

---

## 설정 변경 방법

| 변경 항목   | 파일                                        | 위치                                       |
| ----------- | ------------------------------------------- | ------------------------------------------ |
| 환율        | `api/src/main/resources/config/pricing.yml` | `pricing.ebay.exchange-rate`               |
| 마진율      | 같은 파일                                   | `pricing.automizer.source-margin-map`      |
| 국제배송비  | 같은 파일                                   | `pricing.ebay.international-shipping-usd`  |
| eBay 수수료 | 같은 파일                                   | `pricing.ebay.platform-fee-rate`           |
| 고정마진    | Java 기본값 변경 필요                       | `PricingProperties.EbayConfig.fixedMargin` |

**주의:** `cost-adjustment-usd: 20`은 yml에만 존재하며 코드에서 사용하지 않는 레거시 설정임

---

## 관련 코드

| 파일                          | 역할                                    |
| ----------------------------- | --------------------------------------- |
| `EbayPricingService.java`     | 가격 계산 로직 (calculate 메서드)       |
| `PricingProperties.java`      | 설정값 바인딩 (ConfigurationProperties) |
| `PriceCalculationResult.java` | 계산 결과 DTO                           |
| `EbayListingStrategy.java`    | 리스팅 시 가격 계산 호출                |
| `SellerPortImpl.java`         | calculatePriceUsd() - 외부 호출용       |
| `pricing.yml`                 | 운영/개발 설정값                        |

## 변경된 가격 산정 체계

설정값 (운영)
항목 값
환율 1,470 원/$
국내배송비 4,000원
국제배송비 $40
Fedex 수수료 $8.5
eBay 수수료 20%
관세 DDP 15%
고정마진 10,000원
기본 마진율 20% (소스별 다름, koibito만 40%)
계산 공식

1. 매입비용 = 원가 + 국내배송비(4,000)
2. 국제배송비(원) = 국제배송비($40) × 환율(1,470) = 58,800원
3. Fedex수수료(원) = Fedex($8.5) × 환율(1,470) = 12,495원
4. 고정비용 = 매입비용 + 국제배송비(원) + Fedex수수료(원)
5. 목표마진 = 원가 × 마진율(20%) + 고정마진(10,000)
6. 판매가(원) = (고정비용 + 목표마진) ÷ (1 - 0.20 - 0.15)
   = (고정비용 + 목표마진) ÷ 0.65
7. 판매가(USD) = 판매가(원) ÷ 환율(1,470)

예시 (원가 100,000원)

매입비용 = 100,000 + 4,000 = 104,000
국제배송 = 40 × 1,470 = 58,800
Fedex = 8.5 × 1,470 = 12,495
고정비용 = 104,000 + 58,800 + 12,495 = 175,295
목표마진 = 100,000 × 0.20 + 10,000 = 30,000
판매가(원) = (175,295 + 30,000) ÷ 0.65 = 315,839원 (올림)
판매가($) = 315,839 ÷ 1,470 = $214.86
